local Rayfield = loadstring(game:HttpGet('https://sirius.menu/rayfield'))()

local Window = Rayfield:CreateWindow({
    Name = "dark.cc",
    LoadingTitle = "dark.cc",
    LoadingSubtitle = "Loading. . .",
    ConfigurationSaving = {
        Enabled = true,
        FolderName = "darkconfig",
        FileName = "config"
    },
    KeySystem = true,
    KeySettings = {
        Title = "dark.cc",
        Subtitle = "Key System",
        Note = "Wanna key? buy private - t.me/iceglock66",
        FileName = "darkcc",
        SaveKey = true,
        GrabKeyFromSite = true,
        Key = {"obtfree"}
    }
})

Rayfield:Notify({
    Title = "dark.cc",
    Content = "Loaded! ",
    Duration = 6.5,
    Image = 4483362458,
    Actions = {
        Ignore = {
            Name = "OK",
            Callback = function()
                print("t.me/darkcheatcc")
            end
        },
    },
})

local Tab = Window:CreateTab("Main", 4483362458)

local isEspEnabled = false
local espObjects = {}
local RunService = game:GetService("RunService")
local Players = game:GetService("Players")
local LocalPlayer = Players.LocalPlayer
local CoreGui = game:GetService("CoreGui") -- Получаем CoreGui для надежной отрисовки

local espColor = Color3.new(1, 0, 0)

local function ClearEsp()
    for _, object in pairs(espObjects) do
        if object.Box and object.Box.Parent then
            object.Box:Destroy()
        end
        if object.Text and object.Text.Parent then
            object.Text:Destroy()
        end
    end
    espObjects = {}
end

local function UpdateEsp()
    if not isEspEnabled then 
        ClearEsp()
        return 
    end

    ClearEsp() 
    
    for _, player in pairs(Players:GetPlayers()) do
        if player ~= LocalPlayer and player.Character and player.Character:FindFirstChild("Head") then
            local head = player.Character.Head
            local screenPosition, visible = workspace.CurrentCamera:WorldToScreenPoint(head.Position)

            if visible then
                local espText = Instance.new("TextLabel")
                espText.Text = player.Name
                espText.Position = UDim2.new(0, screenPosition.X, 0, screenPosition.Y)
                espText.Size = UDim2.new(0, 100, 0, 20)
                espText.BackgroundTransparency = 1
                espText.TextColor3 = espColor
                
                -- ИСПРАВЛЕНИЕ: Используем CoreGui для повышения совместимости
                espText.Parent = CoreGui 

                table.insert(espObjects, {Text = espText})
            end
        end
    end
end

RunService.RenderStepped:Connect(function()
    if isEspEnabled then
        UpdateEsp()
    else
        ClearEsp()
    end
end)

Tab:CreateColorPicker({
    Name = "ESP Color",
    Color = Color3.new(1, 0, 0),
    Callback = function(Color)
        espColor = Color
    end,
})

Tab:CreateToggle({
    Name = "Player ESP",
    Callback = function(Value)
        isEspEnabled = Value
        if not Value then
            ClearEsp()
        end
    end,
})
